<?xml version="1.0" encoding="GBK"?>
<!DOCTYPE beans PUBLIC "-//SPRING//DTD BEAN//EN" "http://www.springframework.org/dtd/spring-beans.dtd">
<beans default-autowire="byName">

	<bean id="terminator" class="com.taobao.terminator.client.TerminatorBean4Test" init-method="init">
		<property name="serviceName" value="search4comment" />
		<property name="zkAddress" value="192.168.211.29:2181" />  <!-- 配置项 -->
		<property name="fullCronExpression" value="0 0 2 * * ?" /><!-- 配置项 -->
		<property name="incrCronExpression" value="0 0/5 * * * ?" /><!-- 配置项 -->
		<property name="startupTimerTask" value="false" />
	</bean>

	<bean name="dataProcessor" class="org.taobao.terminator.client.search4comment.CommentDataProcessor" />

	<!-- 数据源配置 -->
	<bean id="commentDataSource" class="org.springframework.jdbc.datasource.DriverManagerDataSource" destroy-method="close">
		<property name="driverClassName" value="com.mysql.jdbc.Driver" />
		<property name="url" value="jdbc:mysql://10.232.64.107:3306/snscomment?characterEncoding=GBK" />
		<property name="username" value="snscomment" />
		<property name="password" value="snscomment" />
	</bean>

	<bean id="feedCommentDataSource" class="org.springframework.jdbc.datasource.DriverManagerDataSource" destroy-method="close">
		<property name="driverClassName" value="com.mysql.jdbc.Driver" />
		<property name="url" value="jdbc:mysql://10.232.64.107:3306/snsfeed?characterEncoding=GBK" />
		<property name="username" value="snsfeed" />
		<property name="password" value="snsfeed" />
	</bean>
	
	<bean name="lastThreeMonthSqlFunc" class="org.taobao.terminator.client.search4comment.LastThreeMonthSqlFunc" />

	<!-- 全量数据导出Bean -->
	<bean id="commentFullDataProvider" class="com.taobao.terminator.client.index.data.MultiTableDataProvider" init-method="init">
		<property name="dataSource" ref="commentDataSource" />
		<property name="subtableDesc" value="0-1" /><!-- 配置项 -->
		<property name="baseSql">
			<value>
				<![CDATA[ 
				SELECT 
					id            as id,
					target_id     as subjectId,
					pro_user_id   as ownerId,
					pro_user_nick as ownerNick,
					content       as content,
					gmt_create    as gmtCreate,
					is_deleted    as isDeleted,
					0             as fromType
				FROM 
					comment$tablename$ 
				WHERE 
					is_deleted = 0
				AND
					gmt_create > '$lastThreeMonth$'
				]]>
			</value>
		</property>
		<property name="plusSqlFuncs" >
			<list>
				<ref bean="lastThreeMonthSqlFunc"/> 
			</list>
		</property>
	</bean>

	<bean id="feedCommentFullDataProvider" class="com.taobao.terminator.client.index.data.MultiTableDataProvider" init-method="init">
		<property name="dataSource" ref="feedCommentDataSource" />
		<property name="subtableDesc" value="0-1" /><!-- 配置项 -->
		<property name="baseSql">
			<value>
				<![CDATA[ 
				SELECT 
					id         as id,
					feed_id    as subjectId,
					comments   as content,
					User_id    as ownerId,
					nick       as ownerNick,
					gmt_create as gmtCreate,
					0          as isDeleted,
					1          as fromType
				FROM 
					feed_comment$tablename$ 
				AND
					gmt_create > '$lastThreeMonth$'
				]]>
			</value>
		</property>
		<property name="plusSqlFuncs" >
			<list>
				<ref bean="lastThreeMonthSqlFunc"/> 
			</list>
		</property>
	</bean>
	
	<bean id="fullDataProvider" class="com.taobao.terminator.client.index.data.MultiDBDataProvider" init-method="init">
		<property name="dataProviders">
			<list>
				<ref bean="commentFullDataProvider" />
				<ref bean="feedCommentFullDataProvider" />
			</list>
		</property>
	</bean>

	<bean id="commentIncrDataProvider" class="com.taobao.terminator.client.index.data.MultiTableDataProvider" init-method="init">
		<property name="dataSource" ref="commentDataSource" />
		<property name="subtableDesc" value="0-1" /><!-- 配置项 -->
		<property name="baseSql">
			<value>
				<![CDATA[ 
				SELECT 
					id            as id,
					target_id     as subjectId,
					pro_user_id   as ownerId,
					pro_user_nick as ownerNick,
					content       as content,
					gmt_create    as gmtCreate,
					is_deleted    as isDeleted,
					0             as fromType 
				FROM 
					comment$tablename$ 
				WHERE 
					gmt_modified<='$endDate$'
				AND
					gmt_modified>='$startDate$' 
				]]>
			</value>
		</property>
	</bean>
	
	<bean id="feedCommentIncrDataProvider" class="com.taobao.terminator.client.index.data.MultiTableDataProvider" init-method="init">
		<property name="dataSource" ref="feedCommentDataSource" />
		<property name="subtableDesc" value="0-1" /><!-- 配置项 -->
		<property name="baseSql">
			<value>
				<![CDATA[ 
				SELECT 
					id         as id,
					feed_id    as subjectId,
					comments   as content,
					User_id    as ownerId,
					nick       as ownerNick,
					gmt_create as gmtCreate,
					0          as isDeleted,
					1          as fromType
				FROM 
					feed_comment$tablename$ 
				WHERE 
					gmt_create<='$endDate$'
				AND
					gmt_create>='$startDate$' 
				]]>
			</value>
		</property>
	</bean>
	
	
	<bean id="incrDataProvider" class="com.taobao.terminator.client.index.data.MultiDBDataProvider" init-method="init">
		<property name="dataProviders">
			<list>
				<ref bean="commentIncrDataProvider" />
				<ref bean="feedCommentIncrDataProvider" />
			</list>
		</property>
	</bean>
</beans>